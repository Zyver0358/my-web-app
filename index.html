<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <title>DBD 2D - Mobile Fixed</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; height: 100vh; width: 100vw; display: flex; justify-content: center; align-items: center; touch-action: none; }
        canvas { display: block; background: #1a211a; }
        .ui { position: fixed; top: 10px; left: 10px; color: white; z-index: 100; pointer-events: none; font-family: sans-serif; font-size: 12px; }
        
        /* Joystick Styling */
        .joystick-container { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: space-between; padding: 0 30px; box-sizing: border-box; z-index: 1000; pointer-events: none; }
        .joystick-base { width: 100px; height: 100px; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; position: relative; pointer-events: auto; }
        .joystick-stick { width: 40px; height: 40px; background: rgba(255,255,255,0.5); border-radius: 50%; position: absolute; top: 30px; left: 30px; }
    </style>
</head>
<body>

    <div class="ui">
        <b>DBD 2D Mobile</b><br>
        <span id="status">Rotate for Landscape</span>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div class="joystick-container">
        <div id="move-joystick" class="joystick-base"><div class="joystick-stick"></div></div>
        <div id="action-btn" class="joystick-base" style="display:flex; align-items:center; justify-content:center; color:white; font-weight:bold;">ATTACK</div>
    </div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// --- 1. SETTINGS ---
const world = { width: 2000, height: 2000 };
const player = { x: 1000, y: 1000, speed: 5, color: "red" };
const joyInput = { x: 0, y: 0 };

// --- 2. RESPONSIVE CANVAS ---
function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    if (window.innerHeight > window.innerWidth) {
        document.getElementById('status').innerText = "PLEASE ROTATE PHONE";
    } else {
        document.getElementById('status').innerText = "Trial in Progress";
    }
}
window.addEventListener('resize', resize);
resize();

// --- 3. JOYSTICK LOGIC ---
const base = document.getElementById('move-joystick');
const stick = base.querySelector('.joystick-stick');

base.addEventListener('touchstart', (e) => e.preventDefault());
base.addEventListener('touchmove', (e) => {
    e.preventDefault();
    const touch = e.targetTouches[0];
    const rect = base.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    
    let dx = touch.clientX - centerX;
    let dy = touch.clientY - centerY;
    const dist = Math.sqrt(dx*dx + dy*dy);
    const max = 40;

    if (dist > max) { dx *= max/dist; dy *= max/dist; }
    
    stick.style.transform = `translate(${dx}px, ${dy}px)`;
    joyInput.x = dx / max;
    joyInput.y = dy / max;
});

base.addEventListener('touchend', () => {
    stick.style.transform = `translate(0px, 0px)`;
    joyInput.x = 0; joyInput.y = 0;
});

// --- 4. ENGINE ---
function loop() {
    // Update
    player.x += joyInput.x * player.speed;
    player.y += joyInput.y * player.speed;

    // Draw
    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.save();
    ctx.translate(canvas.width/2 - player.x, canvas.height/2 - player.y);

    // Draw Ground
    ctx.fillStyle = "#1a211a";
    ctx.fillRect(0, 0, world.width, world.height);

    // Draw Some "Trees" (Boxes) so you can see movement
    ctx.fillStyle = "#444";
    ctx.fillRect(800, 800, 50, 50);
    ctx.fillRect(1200, 900, 50, 50);
    ctx.fillRect(1000, 1200, 50, 50);

    // Draw Player
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x - 20, player.y - 40, 40, 80);

    ctx.restore();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>